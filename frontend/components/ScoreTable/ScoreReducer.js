
const scores = [
	{
		"id": 1,
		"name": "Price",
		"family": "Marshall",
		"city": "Dindigul",
		"score": 173
	},
	{
		"id": 2,
		"name": "Blaine",
		"family": "Galvin",
		"city": "Trochu",
		"score": 955
	},
	{
		"id": 3,
		"name": "Leslie",
		"family": "Yetta",
		"city": "Upper Hutt",
		"score": 664
	},
	{
		"id": 4,
		"name": "Meghan",
		"family": "Elvis",
		"city": "Devon",
		"score": 491
	},
	{
		"id": 5,
		"name": "Ali",
		"family": "Wade",
		"city": "Remagne",
		"score": 528
	},
	{
		"id": 6,
		"name": "Bethany",
		"family": "Nita",
		"city": "Portsoy",
		"score": 537
	},
	{
		"id": 7,
		"name": "Erasmus",
		"family": "Dante",
		"city": "Gonnosfanadiga",
		"score": 270
	},
	{
		"id": 8,
		"name": "Yasir",
		"family": "Baker",
		"city": "Fraser-Fort George",
		"score": 216
	},
	{
		"id": 9,
		"name": "Lynn",
		"family": "Colt",
		"city": "Meerhout",
		"score": 502
	},
	{
		"id": 10,
		"name": "Gemma",
		"family": "Lillian",
		"city": "Wyoming",
		"score": 708
	},
	{
		"id": 11,
		"name": "Yen",
		"family": "Boris",
		"city": "Oberpullendorf",
		"score": 766
	},
	{
		"id": 12,
		"name": "Cadman",
		"family": "Mariam",
		"city": "San José de Maipo",
		"score": 973
	},
	{
		"id": 13,
		"name": "Caleb",
		"family": "Knox",
		"city": "Bromyard",
		"score": 749
	},
	{
		"id": 14,
		"name": "Lavinia",
		"family": "Eugenia",
		"city": "Kester",
		"score": 931
	},
	{
		"id": 15,
		"name": "Zeph",
		"family": "Amela",
		"city": "Ludwigsfelde",
		"score": 667
	},
	{
		"id": 16,
		"name": "Hiram",
		"family": "Candace",
		"city": "Naninne",
		"score": 735
	},
	{
		"id": 17,
		"name": "Fatima",
		"family": "Connor",
		"city": "Bay Roberts",
		"score": 534
	},
	{
		"id": 18,
		"name": "Azalia",
		"family": "Elton",
		"city": "Trevignano Romano",
		"score": 118
	},
	{
		"id": 19,
		"name": "Omar",
		"family": "Stephen",
		"city": "Westende",
		"score": 253
	},
	{
		"id": 20,
		"name": "Julian",
		"family": "Nissim",
		"city": "Toledo",
		"score": 322
	},
	{
		"id": 21,
		"name": "Brenna",
		"family": "Gage",
		"city": "Gojra",
		"score": 833
	},
	{
		"id": 22,
		"name": "Patience",
		"family": "Judith",
		"city": "Esslingen",
		"score": 203
	},
	{
		"id": 23,
		"name": "Wayne",
		"family": "Owen",
		"city": "Groenlo",
		"score": 567
	},
	{
		"id": 24,
		"name": "Jolie",
		"family": "Shelley",
		"city": "Cedar Rapids",
		"score": 758
	},
	{
		"id": 25,
		"name": "Rhea",
		"family": "Garth",
		"city": "Teltow",
		"score": 540
	},
	{
		"id": 26,
		"name": "Lucas",
		"family": "Neil",
		"city": "Panjim",
		"score": 926
	},
	{
		"id": 27,
		"name": "Cailin",
		"family": "Kessie",
		"city": "Chattanooga",
		"score": 231
	},
	{
		"id": 28,
		"name": "Lucy",
		"family": "Sigourney",
		"city": "Buggenhout",
		"score": 913
	},
	{
		"id": 29,
		"name": "Addison",
		"family": "Micah",
		"city": "Carstairs",
		"score": 857
	},
	{
		"id": 30,
		"name": "Alisa",
		"family": "Zenaida",
		"city": "Rouvreux",
		"score": 904
	},
	{
		"id": 31,
		"name": "Charity",
		"family": "Heidi",
		"city": "Bottidda",
		"score": 510
	},
	{
		"id": 32,
		"name": "Marsden",
		"family": "Jacqueline",
		"city": "Harrisburg",
		"score": 218
	},
	{
		"id": 33,
		"name": "Wyoming",
		"family": "Murphy",
		"city": "Segovia",
		"score": 359
	},
	{
		"id": 34,
		"name": "Austin",
		"family": "Leandra",
		"city": "Fort Collins",
		"score": 372
	},
	{
		"id": 35,
		"name": "Ivory",
		"family": "Hector",
		"city": "Guysborough",
		"score": 413
	},
	{
		"id": 36,
		"name": "Valentine",
		"family": "Miranda",
		"city": "Nogales",
		"score": 901
	},
	{
		"id": 37,
		"name": "Tatiana",
		"family": "Laurel",
		"city": "Couture-Saint-Germain",
		"score": 134
	},
	{
		"id": 38,
		"name": "Odysseus",
		"family": "Rae",
		"city": "Edmundston",
		"score": 289
	},
	{
		"id": 39,
		"name": "Amal",
		"family": "Kasper",
		"city": "Avignon",
		"score": 748
	},
	{
		"id": 40,
		"name": "Devin",
		"family": "Lara",
		"city": "Runcorn",
		"score": 822
	},
	{
		"id": 41,
		"name": "Herrod",
		"family": "Amery",
		"city": "Brandon",
		"score": 946
	},
	{
		"id": 42,
		"name": "Ahmed",
		"family": "Demetrius",
		"city": "Fort Worth",
		"score": 607
	},
	{
		"id": 43,
		"name": "Jeanette",
		"family": "Gisela",
		"city": "Dunfermline",
		"score": 525
	},
	{
		"id": 44,
		"name": "Drew",
		"family": "Jade",
		"city": "Bad Vöslau",
		"score": 659
	},
	{
		"id": 45,
		"name": "Virginia",
		"family": "Maris",
		"city": "Laramie",
		"score": 554
	},
	{
		"id": 46,
		"name": "Jesse",
		"family": "Walker",
		"city": "Diepenbeek",
		"score": 935
	},
	{
		"id": 47,
		"name": "Medge",
		"family": "Lamar",
		"city": "Honolulu",
		"score": 277
	},
	{
		"id": 48,
		"name": "Nadine",
		"family": "Robert",
		"city": "Green Bay",
		"score": 631
	},
	{
		"id": 49,
		"name": "Keith",
		"family": "Zia",
		"city": "Munger",
		"score": 381
	},
	{
		"id": 50,
		"name": "Priscilla",
		"family": "Joy",
		"city": "Latinne",
		"score": 858
	},
	{
		"id": 51,
		"name": "Wing",
		"family": "Samuel",
		"city": "Devizes",
		"score": 270
	},
	{
		"id": 52,
		"name": "Tobias",
		"family": "Blossom",
		"city": "Badalona",
		"score": 462
	},
	{
		"id": 53,
		"name": "Eric",
		"family": "Melanie",
		"city": "Fauvillers",
		"score": 980
	},
	{
		"id": 54,
		"name": "Candace",
		"family": "Katelyn",
		"city": "Bolano",
		"score": 313
	},
	{
		"id": 55,
		"name": "Clark",
		"family": "Nicole",
		"city": "Rocca d'Arce",
		"score": 184
	},
	{
		"id": 56,
		"name": "Kelly",
		"family": "Alden",
		"city": "New Westminster",
		"score": 973
	},
	{
		"id": 57,
		"name": "Cadman",
		"family": "Rama",
		"city": "Bilaspur",
		"score": 613
	},
	{
		"id": 58,
		"name": "Allegra",
		"family": "Patrick",
		"city": "Lacombe County",
		"score": 819
	},
	{
		"id": 59,
		"name": "Zachery",
		"family": "Dolan",
		"city": "Pucón",
		"score": 212
	},
	{
		"id": 60,
		"name": "Ariana",
		"family": "Jasmine",
		"city": "Leeuwarden",
		"score": 575
	},
	{
		"id": 61,
		"name": "Austin",
		"family": "MacKensie",
		"city": "Fermont",
		"score": 973
	},
	{
		"id": 62,
		"name": "Kiayada",
		"family": "Lewis",
		"city": "San Felipe",
		"score": 271
	},
	{
		"id": 63,
		"name": "Farrah",
		"family": "Mufutau",
		"city": "Bothey",
		"score": 450
	},
	{
		"id": 64,
		"name": "Evangeline",
		"family": "Kalia",
		"city": "Waitakere",
		"score": 191
	},
	{
		"id": 65,
		"name": "Tatum",
		"family": "Calvin",
		"city": "Oberhausen",
		"score": 435
	},
	{
		"id": 66,
		"name": "Tasha",
		"family": "Kasper",
		"city": "Borås",
		"score": 447
	},
	{
		"id": 67,
		"name": "Elliott",
		"family": "Emily",
		"city": "Hazaribag",
		"score": 113
	},
	{
		"id": 68,
		"name": "Adrienne",
		"family": "Cyrus",
		"city": "Alajuela",
		"score": 175
	},
	{
		"id": 69,
		"name": "Stephen",
		"family": "Akeem",
		"city": "Appleby",
		"score": 469
	},
	{
		"id": 70,
		"name": "Desirae",
		"family": "Jaquelyn",
		"city": "Terlago",
		"score": 504
	},
	{
		"id": 71,
		"name": "Evangeline",
		"family": "Cain",
		"city": "Temploux",
		"score": 864
	},
	{
		"id": 72,
		"name": "Iona",
		"family": "Marsden",
		"city": "Cranbrook",
		"score": 132
	},
	{
		"id": 73,
		"name": "Jenna",
		"family": "Ria",
		"city": "Baiso",
		"score": 692
	},
	{
		"id": 74,
		"name": "Vernon",
		"family": "Daria",
		"city": "Haddington",
		"score": 278
	},
	{
		"id": 75,
		"name": "Jelani",
		"family": "Noble",
		"city": "Redruth",
		"score": 485
	},
	{
		"id": 76,
		"name": "Kiara",
		"family": "Vladimir",
		"city": "Copiapó",
		"score": 375
	},
	{
		"id": 77,
		"name": "Paloma",
		"family": "Alec",
		"city": "Richmond Hill",
		"score": 771
	},
	{
		"id": 78,
		"name": "Nigel",
		"family": "Uriah",
		"city": "Bruderheim",
		"score": 411
	},
	{
		"id": 79,
		"name": "Aladdin",
		"family": "Nelle",
		"city": "Oyo",
		"score": 429
	},
	{
		"id": 80,
		"name": "Cooper",
		"family": "Aurora",
		"city": "Cholet",
		"score": 448
	},
	{
		"id": 81,
		"name": "Felix",
		"family": "Victor",
		"city": "Nijkerk",
		"score": 785
	},
	{
		"id": 82,
		"name": "Christine",
		"family": "Lacey",
		"city": "Marlborough",
		"score": 606
	},
	{
		"id": 83,
		"name": "Hannah",
		"family": "Todd",
		"city": "Carluke",
		"score": 532
	},
	{
		"id": 84,
		"name": "Brady",
		"family": "Fatima",
		"city": "Sant'Elena",
		"score": 526
	},
	{
		"id": 85,
		"name": "Reuben",
		"family": "Brynne",
		"city": "Montenero Val Cocchiara",
		"score": 995
	},
	{
		"id": 86,
		"name": "Akeem",
		"family": "Grady",
		"city": "Dion-Valmont",
		"score": 429
	},
	{
		"id": 87,
		"name": "Lavinia",
		"family": "Dolan",
		"city": "Port Moody",
		"score": 620
	},
	{
		"id": 88,
		"name": "Jenna",
		"family": "Lydia",
		"city": "Nelson",
		"score": 193
	},
	{
		"id": 89,
		"name": "Micah",
		"family": "Palmer",
		"city": "Rio nell'Elba",
		"score": 856
	},
	{
		"id": 90,
		"name": "Cyrus",
		"family": "Cyrus",
		"city": "Lacombe County",
		"score": 623
	},
	{
		"id": 91,
		"name": "Paula",
		"family": "Tobias",
		"city": "Melrose",
		"score": 345
	},
	{
		"id": 92,
		"name": "Aaron",
		"family": "Barry",
		"city": "Cap-de-la-Madeleine",
		"score": 738
	},
	{
		"id": 93,
		"name": "Philip",
		"family": "Dara",
		"city": "Palmerston",
		"score": 215
	},
	{
		"id": 94,
		"name": "Rowan",
		"family": "Quemby",
		"city": "Jamioulx",
		"score": 797
	},
	{
		"id": 95,
		"name": "Leslie",
		"family": "Iris",
		"city": "Hamilton",
		"score": 871
	},
	{
		"id": 96,
		"name": "Zahir",
		"family": "Ciara",
		"city": "Orsogna",
		"score": 555
	},
	{
		"id": 97,
		"name": "Dennis",
		"family": "Amal",
		"city": "San Jose",
		"score": 303
	},
	{
		"id": 98,
		"name": "Patrick",
		"family": "Isadora",
		"city": "Casoli",
		"score": 369
	},
	{
		"id": 99,
		"name": "Connor",
		"family": "Lesley",
		"city": "Kent",
		"score": 547
	},
	{
		"id": 100,
		"name": "Naomi",
		"family": "Rachel",
		"city": "Rock Springs",
		"score": 869
	}
];

const compare = (sort, a, b) => {
	let result = 0;
	const reverse = sort.reverse;
	let transform;

	if (sort.type === 'string') {
		transform = x => x.toUpperCase();
	} else if (sort.type === 'int') {
		transform = parseInt;
	}

	var key = transform ?
		function (x) { return transform(x[sort.field]) } :
		function (x) { return x[sort.field] };

	a = key(a);
	b = key(b);

	if (!reverse) {
		if (a < b) {
			result = -1;
		} else if (a > b) {
			result = 1
		}
	} else {
		if (a < b) {
			result = 1;
		} else if (a > b) {
			result = -1
		}
	}
	return result;
}

function sortBy(sorts) {
	return (a, b) => {
		let len = sorts.length, i = -1;
		let result;

		while (++i < len) {
			result = compare(sorts[i], a, b);
			if (result !== 0) {
				break;
			}
		}
		return result;
	}
}

const initialState = () => {
	const sorts = [{
		field: 'name',
		type: 'string',
		reverse: false,
	}];
	const state = {
		sorts,
		data: [...scores].sort(sortBy(sorts))
	}
	return state;
}

const applySort = (append, fieldName, fieldType, currentState) => {
	let finalState = {};
	let newlySortedData;
	let newSorts = [];
	const existingSort = currentState.sorts.find(x => x.field === fieldName);

	if (append) {
		newSorts = currentState.sorts.map((sort) => {
			if (sort.field === fieldName && !sort.reverse) {
				return { ...sort, reverse: true }
			} else if (sort.field !== fieldName) {
				return sort;
			}
		}).filter(x => x != undefined);
		if (!existingSort) {
			newSorts.push({ field: fieldName, type: fieldType, reverse: false });
		}
	} else {
		if (existingSort) {
			if (!existingSort.reverse) {
				newSorts.push({ ...existingSort, reverse: true });
			}
		} else {
			newSorts.push({ field: fieldName, type: fieldType, reverse: false });
		}
	}

	if (newSorts.length <= 0) {
		newlySortedData = scores;
	} else {
		newlySortedData = [...scores].sort(sortBy(newSorts));
	}

	finalState.sorts = newSorts;
	finalState.data = newlySortedData;
	console.log(finalState);
	return finalState;
}

export default (state = initialState(), action) => {
	switch (action.type) {
		case 'APPLY_SORT':
			return applySort(action.append, action.fieldName, action.fieldType, state);
		default:
			return state;
	}
}